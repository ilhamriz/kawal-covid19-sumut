<% include templates/navbar.ejs %>

  <section id="head-data">
    <div class="container">
      <div class="col wrap-data px-0">
        <h3><strong>Dasboard Kasus Covid-19 di Sumatera Utara</strong></h3>
        <p>Update Terakhir: <span id="last-update">--</span></p>
        <div class="row mt-3">

            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="col-12 wrap-data-1 main-card-data">
                <h6>Total Terkonfirmasi</h6>
                <p id="data-total">--</p>
                <p id="data-total-tambah">--</p>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="col-12 wrap-data-1 data-rawat">
              <h6>Dalam Perawatan</h6>
                <p id="data-rawat">--</p>
                <p id="data-rawat-tambah">--</p>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="col-12 wrap-data-1 data-sembuh">
                <h6>Sembuh</h6>
                <p id="data-sembuh">--</p>
                <p id="data-sembuh-tambah">--</p>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
              <div class="col-12 wrap-data-1 data-meninggal">
                <h6>Meninggal</h6>
                <p id="data-meninggal">--</p>
                <p id="data-meninggal-tambah">--</p>
              </div>
            </div>

        </div>
      </div>
    </div>
  </section>

  <section id="chart">
    <div class="container mt-5">
      <div class="col-12 px-0">
        <h6 id="title-grafik">Grafik Total Harian</h6>
        <div class="row min-chart">

          <div class="col-md-6">
            <div class="col-12 bg-white">
              <h5>Terkonfirmasi</h5>
              <canvas id="chart-konfirmasi" width="400" height="300"></canvas> 
            </div>
          </div>
          <div class="col-md-6">
            <div class="col-12 bg-white">
              <h5>Dirawat</h5>
              <canvas id="chart-rawat" width="400" height="300"></canvas> 
            </div>
          </div>
          <div class="col-md-6">
            <div class="col-12 bg-white">
              <h5>Sembuh</h5>
              <canvas id="chart-sembuh" width="400" height="300"></canvas> 
            </div>
          </div>
          <div class="col-md-6">
            <div class="col-12 bg-white">
              <h5>Meninggal</h5>
              <canvas id="chart-meninggal" width="400" height="300"></canvas> 
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>
    
    <% include templates/footer.ejs %>

    <script>
    getDataPasien();

    let xData = [];
    let yData = [];

    for(var a=0; a<4; a++){
        getChart(a);
    }
    
    async function getChart(code){
        if (code == 0) {
            var ctx = document.getElementById('chart-konfirmasi');
        }
        else if (code == 1) {
            var ctx = document.getElementById('chart-rawat');
        }
        else if (code == 2) {
            var ctx = document.getElementById('chart-sembuh');
        }
        else{
            var ctx = document.getElementById('chart-meninggal');
        }

        await readTodos(code);

        const listLabel = ['Terkonfirmasi', 'Dirawat', 'Sembuh', 'Meninggal'];

        const bgColor = ['rgba(66, 76, 164, .8)', 'rgba(236, 201, 75, .8)', 'rgba(56, 161, 105, .8)', 'rgba(229, 62, 62, .8)'];
        const borderColor = [];

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: xData,
                datasets: [{
                    label: listLabel[code],
                    data: yData,
                    backgroundColor: bgColor[code],
                    borderColor: 'rgba(24, 78, 61, 1)',
                    borderWidth: 1,
                    fill: true,
                    pointRadius: 6
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Tanggal-Bulan'
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                legend: {
                    display: false
                }
                // title: {
                //     display: true,
                //     text: 'Positif Covid-19',
                //     fontSize: 16
                // }
            }
        });

        xData = [];
        yData = [];
        // console.log(ctx.style);
        // $('.chartjs-render-monitor').removeAttr('style');
        // $('.chartjs-render-monitor').removeAttr('width');
        // $('.chartjs-render-monitor').removeAttr('height');
        // ctx.height = "320";
    }

    async function readTodos(code) {
        try{
            const getAPI = await fetch("/api/statistik")
            const data = await getAPI.json();
            // let limit = data.length-15;

            data.map((val) => {
              let tanggal = val.date.split("-").reverse();
              tanggal.pop();
              xData.push(tanggal.join("-"));

              if (code == 0) {
                yData.push(parseInt(val.jumlah_kasus));
              }
              else if (code == 1) {
                yData.push(parseInt(val.jumlah_dirawat));
              }
              else if (code == 2) {
                yData.push(parseInt(val.jumlah_sembuh));
              }
              else{
                yData.push(parseInt(val.jumlah_meninggal));
              }
            });
        
        }
        catch (e) {
            console.log("Error reading the todos.")
        }
    }
    </script>

</body>
</html>